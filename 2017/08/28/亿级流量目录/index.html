<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Cydeer">
  <!-- Open Graph Data -->
  <meta property="og:title" content="亿级流量大纲摘要"/>
  <meta property="og:description" content="不同的生活， 带来不同的际遇， 福祸好歹， 终会积累成经历的一种， 脚步匆匆， 只是不知下一站会在哪里... 一切只是开始，一切也终将继续" />
  <meta property="og:site_name" content="下个路口见"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://www.merlin4io.comundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="下个路口见" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>下个路口见</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">亿级流量大纲摘要</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/<your-github-username>">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:<your-email-address>">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Cydeer</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">8月 28 2017</span>
            <span class="time">20:42:19</span>
          </span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>交易型系统的一些基本原则</p>
<h3 id="高并发"><a href="#高并发" class="headerlink" title="高并发"></a>高并发</h3><ol>
<li>无状态：代码无状态，可以快速回滚，扩容。</li>
<li>拆分：服务垂直拆分</li>
<li>服务化</li>
<li>消息队列（异步处理），大流量缓冲，最后数据校对（防止消息丢失）</li>
<li>数据异构（分库分表之后，数据异构，数据聚合之后异构，可以通过es实现）</li>
<li>并行化（统一请求的不同资源获取，可以并行处理，提高效率）</li>
<li><p>缓存</p>
<ul>
<li>浏览器缓存</li>
<li>app客户端缓存</li>
<li>cdn缓存</li>
<li>接入层缓存</li>
<li>应用层缓存</li>
<li>分布式缓存<a id="more"></a>
<h3 id="高可用"><a href="#高可用" class="headerlink" title="高可用"></a>高可用</h3></li>
</ul>
</li>
<li><p>降级：服务降级，不重要的服务可以做降级处理，数据读取降级，控制只读本地缓存了，只读分布式缓存等。</p>
</li>
<li>限流：防止恶意请求流量，恶意攻击，或者防治流量超过系统峰值，首先要区分出这些请求，能够区分出来的，比如说，这么分流量只请求缓存，ip屏蔽等。    </li>
<li>切流量<ul>
<li>dns切机房</li>
<li>lvs/haproxy切换故障的nginx接入层</li>
<li>nginx切换应用层</li>
</ul>
</li>
<li>可回滚：代码可回滚，部署可回滚，数据可回滚，静态资源可回滚等</li>
<li>隔离：超时隔离等，</li>
<li>业务设计原则<ul>
<li>防重设计：防止重复支付，重复扣库存。</li>
<li>幂等设计：防止消息重复，接口重复调用。</li>
<li>流程可定义：    </li>
<li>状态和状态机：</li>
<li>后台系统操作可反馈：设置之后可以预览</li>
<li>后台系统审批化：一些重要操作要审批，记录操作日志</li>
<li>文档和注释：避免只能看代码了解，文档库：设计架构，设计思想，数据字典，业务流程，现有问题。</li>
<li>备份：代码和人员，代码有仓库管理，人员要有备份，防止突然离职，请假，不可替代。</li>
</ul>
</li>
</ol>
<h4 id="高可用之负载均衡与反向代理"><a href="#高可用之负载均衡与反向代理" class="headerlink" title="高可用之负载均衡与反向代理"></a>高可用之负载均衡与反向代理</h4><ol>
<li>负载均衡的原理：待补充</li>
<li>upstring配置（负载均衡的配置）</li>
<li>负载均衡算法：轮训，加权轮训，随机，加权随机，原地址hash（一致性hash），最小链接法</li>
<li>失败重试，超时重试</li>
<li>健康检查<ul>
<li>tcp心跳检查</li>
<li>http心跳检查</li>
<li>应用健康检查（定时访问应用的api，检查是否畅通）</li>
</ul>
</li>
<li>长链接<ul>
<li>http反向代理</li>
<li>http动态负载均衡</li>
</ul>
</li>
</ol>
<h4 id="高可用之隔离术"><a href="#高可用之隔离术" class="headerlink" title="高可用之隔离术"></a>高可用之隔离术</h4><ol>
<li>线程隔离：不同事情的线程池，使用不同的，重要的业务，单独用，不重要的可以共用一个</li>
<li>进程隔离：应用拆分，不同功能部署不同地方</li>
<li>集群隔离：服务分组，集群中的某些服务单独存在调用链，比如说，秒杀调用链和其他的调用链可以分组，隔离。</li>
<li>机房隔离：不进行跨机房条用，</li>
<li>读写隔离：主从数据库</li>
<li>动静隔离：</li>
<li>爬虫隔离：根据请求头，引流到固定地址</li>
<li>热点隔离：</li>
<li>资源隔离：使用hystrix实现隔离</li>
</ol>
<h4 id="高可用之限流"><a href="#高可用之限流" class="headerlink" title="高可用之限流"></a>高可用之限流</h4><ol>
<li>令牌桶算法：固定速率产生令牌到令牌桶中，令牌桶满了，就丢弃或者拒绝，每个请求过来的时候去令牌桶中获取令牌（一次可以获取多个），获取不到，被限流（丢弃或者在缓冲区等待），获取到了，继续往下走，可以允许突发流量。</li>
<li>漏桶算法：每个请求都先到漏桶中，固定速率从漏桶中获取请求，往下走，如果漏桶满的时候，请求方不进去，直接丢弃。</li>
<li>应用级限流:限流总并发/连接/请求数</li>
<li>分布式限流<ul>
<li>redis+lua实现。</li>
<li>nginx+lua实现。</li>
</ul>
</li>
</ol>
<h4 id="高可用之降级"><a href="#高可用之降级" class="headerlink" title="高可用之降级"></a>高可用之降级</h4><ol>
<li>降级开关</li>
<li>读服务降级</li>
<li>写服务降级</li>
<li>多级降价</li>
<li>配置中心</li>
<li>hystrix实现降级。</li>
</ol>
<h4 id="高可用之重试与重试"><a href="#高可用之重试与重试" class="headerlink" title="高可用之重试与重试"></a>高可用之重试与重试</h4><ol>
<li>web容器超时</li>
<li>中间件客户端超时</li>
<li>数据库客户端超时</li>
<li>nosql客户端超时</li>
<li>业务超时</li>
<li>前段请求超时</li>
</ol>
<h4 id="高可用之回滚"><a href="#高可用之回滚" class="headerlink" title="高可用之回滚"></a>高可用之回滚</h4><ol>
<li>事务回滚</li>
<li>代码库回滚</li>
<li>部署版本回滚</li>
<li>数据版本回滚</li>
<li>静态资源回滚    </li>
</ol>
<p>高可用之压测与预案</p>
<h3 id="高并发之应用级缓存"><a href="#高并发之应用级缓存" class="headerlink" title="高并发之应用级缓存"></a>高并发之应用级缓存</h3><p>缓存命中率（从缓存查/总查询次数）</p>
<h4 id="缓存回收策略"><a href="#缓存回收策略" class="headerlink" title="缓存回收策略"></a>缓存回收策略</h4><ol>
<li>基于空间（大于10兆）</li>
<li>基于容量（大于1000条）</li>
<li>基于时间<ul>
<li>存活期（创建5min后过期）</li>
<li>空闲期（连续5min没有使用过期）</li>
</ul>
</li>
<li>基于java对象<ul>
<li>软引用</li>
<li>弱引用</li>
</ul>
</li>
<li>回收算法<ul>
<li>先入先出fifo</li>
<li>最近最少使用lru</li>
<li>最不常用    lfu</li>
</ul>
</li>
</ol>
<h4 id="java缓存模型"><a href="#java缓存模型" class="headerlink" title="java缓存模型"></a>java缓存模型</h4><ol>
<li>堆缓存</li>
<li>堆外缓存</li>
<li>磁盘缓存</li>
<li>分布式缓存</li>
<li>多级缓存</li>
</ol>
<h4 id="多级缓存api封装"><a href="#多级缓存api封装" class="headerlink" title="多级缓存api封装"></a>多级缓存api封装</h4><ol>
<li>NULLcache。</li>
<li>强制使用最新数据</li>
<li>失败统计</li>
<li>延迟报警</li>
</ol>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

